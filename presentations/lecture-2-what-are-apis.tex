\documentclass[aspectratio=169]{beamer}
\input{sgsss-beamer-preamble}

\title{What Are APIs and Why Use Them?}
\subtitle{Collecting Digital Data --- SGSSS Training Course}

\begin{document}

% -------------------------------------------------------
% Slide 1: Title
% -------------------------------------------------------
{
\setbeamertemplate{frame footer}{}
\begin{frame}[plain]
    \begin{center}
        \includegraphics[height=2.5cm]{../img/SGSSS_Stacked.png}\\[0.8cm]
        {\Large\bfseries\color{sgsssMagenta} Collecting Digital Data}\\[0.2cm]
        {\large What Are APIs and Why Use Them?}\\[0.6cm]
        {\normalsize Dr Diarmuid McDonnell}\\[0.1cm]
        {\small Braw Data Ltd \(\cdot\) Gradel Institute of Charity, University of Oxford}\\[0.3cm]
        {\small 24 February 2026}
    \end{center}
\end{frame}
}

% -------------------------------------------------------
% Slide 2: Section title
% -------------------------------------------------------
\section{What Are APIs and Why Use Them?}

% -------------------------------------------------------
% Slide 2: What is an API?
% -------------------------------------------------------
\begin{frame}{What is an API?}
    \begin{center}
    \begin{tikzpicture}[node distance=3cm]
        % Nodes
        \node[client node] (app) {\faIcon{laptop-code}\\Your Application};
        \node[api node, right=of app] (api) {\faIcon{exchange-alt}\\API};
        \node[server node, right=of api] (service) {\faIcon{database}\\Database/Service};

        % Arrows â€” Request (top) and Response (bottom)
        \draw[arrow style] ([yshift=0.4cm]app.east) -- ([yshift=0.4cm]api.west)
            node[midway, above, font=\small] {Request};
        \draw[arrow style] ([yshift=-0.4cm]api.west) -- ([yshift=-0.4cm]app.east)
            node[midway, below, font=\small] {Response};

        \draw[arrow style] ([yshift=0.4cm]api.east) -- ([yshift=0.4cm]service.west)
            node[midway, above, font=\small] {Query};
        \draw[arrow style] ([yshift=-0.4cm]service.west) -- ([yshift=-0.4cm]api.east)
            node[midway, below, font=\small] {Data};
    \end{tikzpicture}
    \end{center}

    \vspace{0.3cm}
    \textbf{API} = \textbf{A}pplication \textbf{P}rogramming \textbf{I}nterface

    \vspace{0.2cm}
    {\small Think of it as a \alert{translator}: your application doesn't need to know
    \emph{how} the database is organised --- it just asks the API in a standard way,
    and the API returns structured data.}
\end{frame}

% -------------------------------------------------------
% Slide 3: APIs vs web scraping
% -------------------------------------------------------
\begin{frame}{APIs vs Web Scraping}
    \centering
    \small
    \begin{tabular}{@{}l >{\raggedright\arraybackslash}p{4.5cm} >{\raggedright\arraybackslash}p{4.5cm}@{}}
        \toprule
        & \textbf{Web Scraping} & \textbf{APIs} \\
        \midrule
        \textbf{Data format}
            & Unstructured HTML
            & Structured JSON/XML \\[0.3em]
        \textbf{Reliability}
            & Breaks when site changes
            & Versioned, documented \\[0.3em]
        \textbf{Legality}
            & Grey area
            & Usually explicit ToS \\[0.3em]
        \textbf{Rate limits}
            & You must self-impose
            & Enforced by provider \\[0.3em]
        \textbf{Authentication}
            & Usually none
            & Often API key \\
        \bottomrule
    \end{tabular}

    \vspace{0.5cm}
    \begin{alertblock}{Rule of thumb}
        If an API exists, use it. Web scraping is a last resort.
    \end{alertblock}
\end{frame}

% -------------------------------------------------------
% Slide 4: Anatomy of an API call
% -------------------------------------------------------
\begin{frame}{Anatomy of an API Call}
    \begin{center}
    \begin{tikzpicture}[
        every node/.style={font=\small},
        brace/.style={decorate, decoration={brace, amplitude=5pt, raise=2pt}},
        label/.style={font=\footnotesize, align=center},
    ]
        % The full URL
        \node[anchor=west, font=\ttfamily\footnotesize] (url) at (0,0) {%
            \textcolor{sgsssGreen}{https://data.police.uk}%
            \textcolor{sgsssBlack}{/api/stops-force}%
            \textcolor{sgsssMagenta}{?force=city-of-london\&date=2024-01}%
        };

        % Braces and labels underneath
        \draw[brace, sgsssGreen] (0,-0.15) -- (3.55,-0.15)
            node[below=8pt, midway, label, text=sgsssGreen] {Base URL};
        \draw[brace, sgsssBlack] (3.55,-0.15) -- (6.35,-0.15)
            node[below=8pt, midway, label, text=sgsssBlack] {Endpoint};
        \draw[brace, sgsssMagenta] (6.35,-0.15) -- (12.65,-0.15)
            node[below=8pt, midway, label, text=sgsssMagenta] {Query parameters\\{\scriptsize key=value pairs joined by \&}};

        % Headers and Auth boxes
        \node[data node, below=2.5cm of url.west, anchor=west, minimum width=4.5cm] (headers) {%
            \faIcon{envelope}\;\textbf{Headers}\\[2pt]
            {\footnotesize\ttfamily Accept: application/json}%
        };
        \node[data node, right=1cm of headers, minimum width=4.5cm] (auth) {%
            \faIcon{key}\;\textbf{Authentication}\\[2pt]
            {\footnotesize API key, OAuth token, or none}%
        };
    \end{tikzpicture}
    \end{center}

    \vspace{0.1cm}
    {\small The UK Police API is \textbf{open} --- no authentication needed. Many other
    APIs require an API key sent as a header or query parameter.}
\end{frame}

% -------------------------------------------------------
% Slide 5: Reading API documentation
% -------------------------------------------------------
\begin{frame}{Reading API Documentation}
    \small
    \textbf{What to look for when you open the docs:}

    \vspace{0.15cm}
    \begin{itemize}\itemsep0pt
        \item[\textcolor{sgsssGreen}{\faIcon{check-circle}}] \textbf{Endpoints} --- what URLs are available and what data do they return?
        \item[\textcolor{sgsssGreen}{\faIcon{check-circle}}] \textbf{Authentication method} --- API key, OAuth, or open access?
        \item[\textcolor{sgsssGreen}{\faIcon{check-circle}}] \textbf{Rate limits} --- how many requests per minute/day?
        \item[\textcolor{sgsssGreen}{\faIcon{check-circle}}] \textbf{Response format} --- JSON, XML, CSV?
        \item[\textcolor{sgsssGreen}{\faIcon{check-circle}}] \textbf{Example requests \& responses} --- try them in a browser first!
    \end{itemize}

    \vspace{0.15cm}
    \begin{exampleblock}{UK Police API --- \texttt{data.police.uk/docs/}}
        \scriptsize
        \begin{itemize}\itemsep0pt
            \item[\textcolor{sgsssGreen}{\faIcon{check}}] Open access (no key needed)
            \item[\textcolor{sgsssGreen}{\faIcon{check}}] Returns JSON
            \item[\textcolor{sgsssGreen}{\faIcon{check}}] Rate limit: 15 requests per second
            \item[\textcolor{sgsssGreen}{\faIcon{check}}] Endpoints: stop-and-search, crimes, neighbourhoods, forces
        \end{itemize}
    \end{exampleblock}
\end{frame}

% -------------------------------------------------------
% Slide 6: JSON deep-dive
% -------------------------------------------------------
\begin{frame}[fragile]{JSON Deep-Dive}
    \begin{columns}[T]
        \begin{column}{0.48\textwidth}
            \textbf{Structure}\\[0.2cm]
            \begin{tikzpicture}[
                box/.style={draw, rounded corners=3pt, thick, inner sep=6pt},
            ]
                % Outer object
                \node[box, draw=sgsssBlack, fill=sgsssLightGrey, minimum width=6.2cm, minimum height=4.5cm] (outer) at (0,0) {};
                \node[anchor=north west, font=\ttfamily\bfseries] at ([shift={(3pt,-3pt)}]outer.north west) {\textcolor{sgsssBlack}{\{}};
                \node[anchor=south east, font=\ttfamily\bfseries] at ([shift={(-3pt,3pt)}]outer.south east) {\textcolor{sgsssBlack}{\}}};

                % Key-value pairs
                \node[anchor=west, font=\ttfamily\small] at (-2.6,1.4) {%
                    \textcolor{sgsssGreen}{"type"}: \textcolor{sgsssMagenta}{"Person"}%
                };
                \node[anchor=west, font=\ttfamily\small] at (-2.6,0.8) {%
                    \textcolor{sgsssGreen}{"age\_range"}: \textcolor{sgsssMagenta}{"18-24"}%
                };

                % Array box
                \node[box, draw=sgsssMagenta, fill=sgsssMagenta!5, minimum width=5cm, minimum height=1.8cm] (arr) at (0.2,-0.6) {};
                \node[anchor=west, font=\ttfamily\small] at (-2.6,0.15) {%
                    \textcolor{sgsssGreen}{"legislation"}:%
                };
                \node[anchor=north west, font=\ttfamily\bfseries] at ([shift={(3pt,-3pt)}]arr.north west) {\textcolor{sgsssMagenta}{[}};
                \node[anchor=south east, font=\ttfamily\bfseries] at ([shift={(-3pt,3pt)}]arr.south east) {\textcolor{sgsssMagenta}{]}};

                % Nested object inside array
                \node[box, draw=sgsssGreen, fill=sgsssGreen!8, minimum width=4cm, minimum height=0.8cm] (nested) at (0.2,-0.6) {};
                \node[font=\ttfamily\scriptsize] at (0.2,-0.6) {%
                    \textcolor{sgsssGreen}{"name"}: \textcolor{sgsssMagenta}{"PACE (1984)"}%
                };
            \end{tikzpicture}

            \vspace{0.2cm}
            {\footnotesize
            \textcolor{sgsssGreen}{\rule{0.8cm}{2pt}} Keys \quad
            \textcolor{sgsssMagenta}{\rule{0.8cm}{2pt}} Values}
        \end{column}
        \begin{column}{0.48\textwidth}
            \textbf{As code}
            \begin{minted}[fontsize=\scriptsize]{json}
{
  "type": "Person",
  "age_range": "18-24",
  "legislation": [
    {
      "name": "PACE (1984)"
    }
  ],
  "outcome": true
}
\end{minted}

            \vspace{0.2cm}
            {\small \textbf{JSON types:}}
            \begin{itemize}
                \footnotesize
                \item \textbf{Object} \texttt{\{\}} --- key-value pairs
                \item \textbf{Array} \texttt{[]} --- ordered list
                \item \textbf{String}, \textbf{Number}, \textbf{Boolean}, \textbf{null}
            \end{itemize}
        \end{column}
    \end{columns}
\end{frame}

% -------------------------------------------------------
% Slide 7: Next up
% -------------------------------------------------------
\begin{frame}{Next Up}
    \begin{center}
        {\Large \alert{Practical 2: UK Police API}}\\[0.5cm]
        \begin{itemize}
            \item Make your first API request (in a browser, then in code)
            \item Parse JSON responses into tabular data
            \item Explore stop-and-search data for a chosen police force
            \item Handle pagination and query parameters
        \end{itemize}
        \vspace{0.5cm}
        {\normalsize Open the \textbf{Practical 2} notebook in Google Colab\\(Python or R --- your choice!)}
    \end{center}
\end{frame}

\end{document}
